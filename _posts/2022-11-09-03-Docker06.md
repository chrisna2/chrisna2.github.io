---
title: "[MSA] 도커 컨테이너 다루기 : 볼륨"
date: 2022-11-09 15:40:00 +0900
categories: MSA
classes: wide
---

# 도커 컨테이너 다루기 : 볼륨

## 1. 도커 레이어 아키텍처
![도커 볼륨 01](/images/20221109_docker_volume01.png)

- [1] 이미지 레이어 :  

    ```bash
    $ docker build -t app
    ```

    - dockerfile을 통해 빌드된 이미지의 내용은 컨테이너로 실행시 변경되지 않는다. 

    - 컨테이너로 처음 올라갈 경우 이미 5단계로 구축된 ***읽기 전용*** 레이어는 컨테이너 실행시에 변경 되지 않는다. 

        - 레이어 1 : 운영체제, OS, ubuntu
        - 레이어 2 : 운영체제 깔리는 소프트웨어 패키지, apt package, WAS, DBMS 등
        - 레이어 3 : 소스가 구성되는 라이브러리 단계, pip, maven, gradle, npm 등등 
        - 레이어 4 : 소스 코드 (java, python, 등등)
        - 레이어 5 : 엔트리 포인트 단계, 빌드된 프로그램이 시작 및 실행되는 상태, JVM 환경변수 설정 등등.. 

    <br/>

    ※ **엔트리포인트** : 엔트리 포인트(entry point) 또는 진입점(進入點)은 제어가 운영 체제에서 컴퓨터 프로그램으로 이동하는 것을 말하며, 프로세서는 프로그램이나 코드에 진입해서 실행을 시작한다. 어떤 운영체제나 프로그래밍 언어에서, 초기 엔트리는 프로그램의 한 부분이 아니라 런타임 라이브러리의 한 부분이다. 즉 런타임 라이브러리가 프로그램을 초기화하고 프로그램에 진입한다. 다른 경우에는 프로그램이 진입 직후에 바로 런타임 라이브러리를 호출하고, 이것이 반환된 후에 실제 실행을 시작한다. 이것은 로드 타임에서 런타임으로의 전환이다. 


- [2] 컨테이너 레이어 :  

    ```bash
    $ docker run app
    ```

    - 이미지를 실행하면 컨테이너가 된다. 컨테이너 기동 상태에서 내부 내용의 변경이 가능하다.
    
    - 컨테이너를 종료 하여하면 초기 이미지의 5단계 설정으로 돌아간다. 

## 2. 호스트 볼륨

- 호스트의 디렉토리를 컨테이너의 특정 경로에 마운트한다.

- docker를 실행 시키는 서버의 호스트를 
말한다. 

- 실제 도커가 설치되고 컨테이너가 실행되는 물리적 서버의 호스트

    ```bash
    # 호스트의 /opt/html 디렉토리를 Nginx의 웹 루트 디렉토리로 마운트
    $ docker run -d \
    --name nginx \
    -v /opt/html:/usr/share/nginx/html \
    nginx
    ```

## 3. 볼륨 컨테이너

## 4. 도커 볼륨

## 5. 읽기 전용 볼륨 연결