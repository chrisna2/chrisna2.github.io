---
title: "[MSA] 도커 다루기 : 명시적으로 여러개의 컨테이너 관리하기"
date: 2022-11-21 13:45:00 +0900
categories: MSA
classes: wide
---

# 도커 컴포즈 : 명시적으로 여러개의 컨테이너 관리하기

## 1. 도커 컴포즈 (Docker Compose) 소개

- 단일 서버에서 여러 컨테이너를 **프로젝트 단위로 묶어서** 관리 <br/>
docker-compose.yml YAML 파일을 통해 명시적으로 관리

- 주요기능
    1. 프로젝트 단위로 도커 네트워크와 볼륨을 관리
    2. 프로젝트 내 서비스 간 의존성 정의 
    3. 프로젝트 내 서비스 디스커버리 자동화
    4. 손 쉬운 컨테이너 수평 확장


## 2. 프로젝트 / 서비스 / 컨테이너
![도커 컴포즈 (Docker Compose) 소개2](/images/20221121_docker_compose02.PNG)

- 프로젝트(Project)
    - docker-compose.yaml 에서 구성하는 프로젝트 명세 내용
    - 도커 컴포즈에서 다루는 워크스페이스 단위.
    - 함께 관리하는 서비스 컨테이너의 묶음.
    - 프로젝트 단위로 기본 도커 네트워크가 생성 됨.

- 서비스(Services)
    - 도커 컴포즈에서 컨테이너를 관리하기 위한 단위.
    - scale을 통해 서비스 컨테이너의 수 확장 가능.

- 컨테이너(Containers)
    - 서비스를 통해 컨테이너 관리.


## 3. docker-compose.yml
![도커 컴포즈 (Docker Compose) 소개2](/images/20221121_docker_compose03.PNG)

- version, services, networks, volumes 총 4개의 최상위 옵션

- 버전 (version)
    - 가능한 최신 버전 사용 권장
    - 도커 엔진 및 도커 컴포즈 버전에 따른 호환성 매트릭스 참조
    - cf) 버전 3 부터 도커 스웜(Docker Swarm)과 호환
        <br/> -> Swarm 서비스를 docker-compose.yml로 정의 가능
        <br/> -> docker-compose.yml의 옵션 가운데 docker swarm에서 사용가능한 옵션인지 아닌지 구분 필요!    
    
    - 도커 스웜(Docker Swarm)
        - 여러 서버를 기반으로 스웜 클러스터를 형성하여 컨테이너를 관리하는 <br/> **컨테이너 오케스트레이션 시스템.**
        - 쿠버네트스와 동일한 목적으로 만들어 졌지만 인기가 쿠버네티스만 못함

- 서비스 (Services)


- 네트웍스 (networks)
    - default 옵션이 있음

- 볼륨 (volumes)

## 4. docker-compose 명령어

- docker-compose 명령어 : 프로젝트 목록

```bash
# 실행중인 프로젝트 목록 확인
$ docker-compose ls
# 전체 프로젝트 모록 확인
$ docker-compose ls -a
```

- docker for windows 

```console

PS C:\Workspace\docker\fastcampus-devops\3-docker-kubernetes\4-docker-compose\build> docker-compose -p my-project up -d
Use 'docker scan' to run Snyk tests against images to find vulnerabilities and learn how to fix them
[+] Running 3/3
 - Network my-project_default    Created                                                                           0.8s
 - Container my-project-web-1    Started                                                                           1.7s
 - Container my-project-redis-1  Started                                                                           1.7s
PS C:\Workspace\docker\fastcampus-devops\3-docker-kubernetes\4-docker-compose\build> docker-compose ls
NAME                STATUS              CONFIG FILES
my-project          running(2)          C:\Workspace\docker\fastcampus-devops\3-docker-kubernetes\4-docker-compose\build\docker-compose.yml
PS C:\Workspace\docker\fastcampus-devops\3-docker-kubernetes\4-docker-compose\build> docker-compose ls -a
NAME                STATUS              CONFIG FILES
build               exited(2)           C:\Workspace\docker\fastcampus-devops\3-docker-kubernetes\4-docker-compose\build\docker-compose.yml
my-project          running(2)          C:\Workspace\docker\fastcampus-devops\3-docker-kubernetes\4-docker-compose\build\docker-compose.yml


```

- docker-compose 명령어 : 실행 및 종료

```bash

# Foreground로 도커 컴포즈 프로젝트 실행
$ docker-compose up
# Background로 도커 컴포즈 프로젝트 실행
$ docker-compose up -d
# 프로젝트 이름 my-project로 변경하여 도커 컴포즈 프로젝트 실행
$ docker-compose up -p my-project -d
# 프로젝트 내 컨테이너 및 네트워크 종료 및 제거
$ docker-compose down
# 프로젝트 내 컨테이너, 네트워크 및 볼륨 종료 및 제거
$ docker-compose down -v

```


## 5. 주요 사용 목적
