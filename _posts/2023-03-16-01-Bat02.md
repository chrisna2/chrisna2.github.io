---
title: "[CHATGPT] bat 파일 작성하기 - 02"
date: 2023-03-16 02:50:00 +0900
categories: bat, shell
classes: wide
---
# BAT 파일 작성하는 방법 인공지능 선생님께 물어보기


## [1] bat 스크립트에서 디렉토리 안에 있는 다수의 sql 파일을 실행하는 방법 

Windows Batch 파일을 사용하여 디렉토리 내의 모든 SQL 파일을 실행하려면 다음 단계를 따라 작성하십시오.

### 1. 먼저, 오라클 클라이언트를 설치하고 환경 변수 PATH에 추가하여 sqlplus 명령이 실행되도록 해야 합니다.

### 2. 아래 코드를 입력합니다.

```bat
@echo off
setlocal enabledelayedexpansion

:: 데이터베이스 연결 정보 설정
set DB_CONNECTION_STRING=YOUR_USERNAME/YOUR_PASSWORD@YOUR_HOST:YOUR_PORT/YOUR_SERVICE_NAME

:: SQL 파일이 있는 디렉토리 설정
set SQL_FILES_DIR=C:\path\to\your\sql\files

:: 디렉토리의 모든 SQL 파일 실행
for %%f in (%SQL_FILES_DIR%\*.sql) do (
    echo Executing file: %%f
    sqlplus -S !DB_CONNECTION_STRING! @"%%f"
    echo Finished executing file: %%f
)

echo All SQL files have been executed.
```

위 코드에서 필요한 정보를 채워 넣으십시오.

* DB_CONNECTION_STRING: 오라클 데이터베이스 연결 문자
(예: username/password@localhost:1521/orclpdb1)

* SQL_FILES_DIR: SQL 파일이 저장된 디렉토리 경로

이제 수정한 .bat 파일을 저장한 후 실행하면, 디렉토리에 있는 모든 SQL 파일이 순차적으로 오라클 데이터베이스에 실행됩니다.

## [2] bat 스크립트에서 에러발생 시 throw를 던지는 방법

### 1. errorlevel 설정

Windows Batch 스크립트에서 에러가 발생할 때 오류를 던지려면 errorlevel을 사용하여 명령의 실행 상태를 확인하고, 원하는 오류 코드로 종료해야 합니다.

예를 들어, 오라클 데이터베이스를 사용하는 이전 예제를 기반으로 에러가 발생했을 때 스크립트가 종료되도록 수정하겠습니다.

### 2. 예제 소스

```bat
@echo off
setlocal enabledelayedexpansion

:: 데이터베이스 연결 정보 설정
set DB_CONNECTION_STRING=YOUR_USERNAME/YOUR_PASSWORD@YOUR_HOST:YOUR_PORT/YOUR_SERVICE_NAME

:: SQL 파일이 있는 디렉토리 설정
set SQL_FILES_DIR=C:\path\to\your\sql\files

:: 디렉토리의 모든 SQL 파일 실행
for %%f in (%SQL_FILES_DIR%\*.sql) do (
    echo Executing file: %%f
    sqlplus -S !DB_CONNECTION_STRING! @"%%f"
    
    if errorlevel 1 (
        echo Error occurred while executing file: %%f
        exit /b 1
    )
    echo Finished executing file: %%f
)

echo All SQL files have been executed without errors.
```

이제 위의 배치 파일에서 sqlplus 명령 실행 시 오류가 발생하면, "Error occurred while executing file" 메시지가 출력되고 스크립트가 종료됩니다. exit /b 1 명령은 스크립트를 종료하고 오류 코드 1을 반환합니다.

이 방법을 사용하여 명령 실행 중 오류가 발생할 때마다 원하는 오류 코드와 메시지를 반환하도록 스크립트를 수정할 수 있습니다.
